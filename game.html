<!DOCTYPE html>
<html lang="nl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Panel Layout</title>
    <style>
      :root {
        --bg: #14161a;
        --panel: #20242c;
        --panel2: #2a2f3a;
        --text: #e8eaf0;
        --muted: #aab0bd;
        --accent: #5865f2;
        --border: #2a2f3a;
        --radius: 14px;
      }
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      html,
      body {
        height: 100%;
        background: var(--bg);
        color: var(--text);
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica,
          Arial;
      }
      h1 {
        margin-bottom: 6px;
      }
      h2 {
        margin-bottom: 6px;
      }
      h3 {
        margin-bottom: 6px;
      }
      .app {
        max-width: 1000px;
        margin: 0 auto;
        padding: 16px;
        display: flex;
        flex-direction: column;
        gap: 12px;
      }
      .card {
        background: var(--panel);
        border: 1px solid var(--border);
        border-radius: var(--radius);
      }
      .hd {
        padding: 14px 16px;
        border-bottom: 1px solid var(--border);
        background: linear-gradient(180deg, var(--panel2), var(--panel));
        border-top-left-radius: var(--radius);
        border-top-right-radius: var(--radius);
      }
      .bd {
        padding: 16px;
      }
      .btn {
        background: var(--accent);
        color: #fff;
        border: none;
        padding: 8px 12px;
        border-radius: 10px;
        cursor: pointer;
      }
      .btn.ghost {
        background: transparent;
        border: 1px solid #3a4152;
        color: var(--text);
      }
      .row {
        display: flex;
        gap: 16px;
        flex-wrap: wrap;
        align-items: center;
      }
      .panel {
        display: none;
      }
      .panel.active {
        display: block;
      }
      .muted {
        color: var(--muted);
      }
      .col {
        display: flex;
        flex-direction: column;
        gap: 16px;
      }
      .sep {
        height: 1px;
        background: #2a2f3a;
        margin: 8px 0;
      }
    </style>
  </head>
  <body>
    <div class="app">
      <!-- Panels -->
      <section class="panel card active" data-panel="hoofdmenu">
        <div class="hd">Hoofdmenu</div>
        <div class="bd col">
          <div>
            <h2>Welkom bij het Dobbelspel</h2>
            <p class="muted">
              Dit spel combineert geluk, spanning en uitdaging. Met vijf
              dobbelstenen strijd je tegen elkaar om punten te verdienen,
              terwijl de verliezer telkens een opdracht uitvoert. De sfeer mag
              speels en uitdagend zijn, maar het blijft altijd gebaseerd op
              instemming en respect.
            </p>
          </div>

          <div>
            <h3>Doel van het spel</h3>
            <p class="muted">
              Verzamel zoveel mogelijk punten door slim te dobbelen. Wie een
              ronde wint, krijgt één punt op zijn totaalscore. Zodra alle
              spelers behalve één “safe” zijn, voert de overgebleven speler een
              opdracht uit. Daarna begint een nieuwe cyclus met iedereen weer op
              nul.
            </p>
          </div>

          <div>
            <h3>Spelverloop</h3>
            <ul class="muted" style="padding-left: 20px; line-height: 1.6">
              <li>
                Elke speler krijgt per beurt een vast aantal worpen (bijv. 3).
              </li>
              <li>
                Na elke worp kunnen één of meer dobbelstenen worden vastgezet of
                losgelaten.
              </li>
              <li>
                Na de laatste worp wordt de score bepaald op basis van de
                gegooide combinaties.
              </li>
              <li>
                De speler met de hoogste score wint de ronde en krijgt 1 punt.
              </li>
              <li>
                Wanneer een speler het ingestelde aantal punten bereikt, is die
                “safe”.
              </li>
              <li>
                Wanneer er nog één speler overblijft, voert deze een opdracht
                uit.
              </li>
            </ul>
          </div>

          <div>
            <h3>Puntentelling</h3>
            <ul class="muted" style="padding-left: 20px; line-height: 1.6">
              <li>Elke dobbelsteen telt slechts één keer mee.</li>
              <li>Dobbelstenen met hetzelfde getal vormen een groep.</li>
              <li>
                De waarde is het getal met een nul per extra dobbelsteen in die
                groep.<br />
                Voorbeeld: twee 2’en = 20 punten, drie 1’en = 100 punten.
              </li>
              <li>Alle groepen worden opgeteld tot één totaalscore.</li>
            </ul>
          </div>

          <div>
            <h3>Opdrachten</h3>
            <p class="muted">
              De verliezer van elke cyclus krijgt een opdracht toegewezen.
              Opdrachten kunnen luchtig, speels of uitdagend zijn, afhankelijk
              van de categorieën die vooraf zijn geselecteerd in het menu
              Instellingen.
            </p>
          </div>

          <div>
            <h3>Instemming en spelafspraken</h3>
            <p class="muted">
              Voorafgaand aan het spel stemt iedere speler er bewust mee in om
              volledig mee te spelen binnen de grenzen van wat in de
              instellingen is gekozen. Door in te stemmen verklaart een speler
              dat hij of zij elke opdracht die door het spel wordt gegeven, zal
              uitvoeren zoals bedoeld — ongeacht met wie of wat deze betrekking
              heeft. Zo blijft het spel eerlijk, consequent en leuk voor
              iedereen die meedoet.
            </p>
          </div>

          <div class="sep"></div>

          <div class="row">
            <button class="btn" data-panel="instellingen">Instellingen</button>
            <button class="btn" data-panel="spel">Start spel</button>
          </div>
        </div>
      </section>

      <section class="panel card" data-panel="instellingen">
        <div class="hd">Instellingen</div>
        <div class="bd col">
          <div>
            <h3>Opdrachten</h3>
            <p class="muted">
              Kies hier welke opdrachten er gebruikt worden in het spel.
            </p>
            <div id="settings_tasks"></div>
          </div>

          <div class="row">
            <button class="btn" data-panel="hoofdmenu">Hoofdmenu</button>
          </div>
        </div>
      </section>

      <section class="panel card" data-panel="spel">
        <div class="hd">Spel</div>
        <div class="bd muted">Inhoud voor spel</div>
      </section>

      <section class="panel card" data-panel="opdracht">
        <div class="hd">Opdracht</div>
        <div class="bd muted">Inhoud voor opdracht</div>
      </section>

      <section class="panel card" data-panel="registratie">
        <div class="hd">Speler Registratie</div>
        <div class="bd muted">Inhoud voor registratie</div>
      </section>
    </div>

    <!-- ==== Storage: helpers (localStorage) ==== -->
    <script>
      const LS_KEY = "game_flow_autosave_v1";

      function storageSaveGame(gameState) {
        try {
          localStorage.setItem(LS_KEY, JSON.stringify(gameState));
        } catch {}
      }

      function storageLoadGame() {
        try {
          const raw = localStorage.getItem(LS_KEY);
          return raw ? JSON.parse(raw) : null;
        } catch {
          return null;
        }
      }

      function storageClearGame() {
        try {
          localStorage.removeItem(LS_KEY);
        } catch {}
      }
    </script>

    <!-- ==== Panels: data + helpers ==== -->
    <script>
      function showPanel(key) {
        document
          .querySelectorAll(".panel")
          .forEach((p) =>
            p.classList.toggle("active", p.dataset.panel === key)
          );
      }

      // helper die je 1x (of vaker) kunt aanroepen; werkt ook voor nieuw toegevoegde buttons
      let _panelNavHandler = null;
      function attachPanelNavigation() {
        if (_panelNavHandler) {
          document.removeEventListener("click", _panelNavHandler);
        }
        _panelNavHandler = (e) => {
          const btn = e.target.closest("[data-panel]");
          if (!btn) return;
          const key = btn.dataset.panel;
          showPanel(key);
          // ⤵ sla de actieve panel op als gameSetActivePanel beschikbaar is
          if (window.gameSetActivePanel) gameSetActivePanel(key);
        };
        document.addEventListener("click", _panelNavHandler);
      }

      // eenmalig aanroepen na het renderen van je panels
      attachPanelNavigation();
    </script>

    <!-- ==== Player: data + helpers ==== -->
    <script>
      // ===== Base clothing model =====
      const CLOTHING_MODEL = {
        headwear: {
          name: "Hoofdbedekking",
          desc: "Voorbeelden: hoeden, petten, beanies, haarbanden. Omvat: alle items die op het hoofd worden gedragen (alles samen één item).",
          worn: true,
          enabled: false,
          removeRules: [],
        },

        accessories_glasses: {
          name: "Bril",
          desc: "Voorbeelden: (zonne)bril, modieuze bril zonder sterkte. Omvat: elk type bril of zonnebril (alles samen één item).",
          worn: true,
          enabled: false,
          removeRules: [],
        },

        accessories_neck: {
          name: "Nekversiering",
          desc: "Voorbeelden: kettingen, chokers, sjaals, bandana’s, halsdoeken. Omvat: alle accessoires die om de nek worden gedragen (alles samen één item).",
          worn: true,
          enabled: false,
          removeRules: [],
        },

        accessories_arm: {
          name: "Armversiering",
          desc: "Voorbeelden: armbanden, polsbandjes, horloges, cuffs. Omvat: alle accessoires die om pols of arm worden gedragen (alles samen één item).",
          worn: true,
          enabled: false,
          removeRules: [],
        },

        jacket: {
          name: "Jas",
          desc: "Voorbeelden: winterjas, trenchcoat, leren jas, regenjas. Omvat: elke buitenste bovenlaag bedoeld als jas/coat.",
          worn: true,
          enabled: false,
          removeRules: [],
        },

        sweater: {
          name: "Trui",
          desc: "Voorbeelden: trui, vest, hoodie, cardigan. Omvat: bovenlaag die over een shirt gaat en onder een jas valt.",
          worn: true,
          enabled: false,
          removeRules: [{ notWorn: ["jacket"] }],
        },

        shirt: {
          name: "Shirt",
          desc: "Voorbeelden: T-shirt, overhemd, blouse, (korte) jurk. Omvat: de primaire bovenkledinglaag boven hemd/onderlaag en onder trui/jas.",
          worn: true,
          enabled: true,
          removeRules: [{ notWorn: ["jacket", "sweater"] }],
        },

        undershirt: {
          name: "Hemd",
          desc: "Voorbeelden: hemd, topje, tanktop (niet als ondergoed bedoeld). Omvat: laag direct onder het shirt maar niet zijnde BH/ondergoed.",
          worn: true,
          enabled: false,
          removeRules: [{ notWorn: ["jacket", "sweater", "shirt"] }],
        },

        bra: {
          name: "Bh",
          desc: "Voorbeelden: BH, bikini-top, bovenhelft badpak (ééndelig). Omvat: elke ondersteunende of zwem-bovenhelft.",
          worn: true,
          enabled: true,
          removeRules: [
            { notWorn: ["jacket", "sweater", "shirt", "undershirt"] },
          ],
        },

        pants: {
          name: "Broek",
          desc: "Voorbeelden: jeans, korte broek, sport- of pyjamabroek, rok(je). Omvat: alle kleding die als buitenste onderlichaamslaag wordt gedragen (broeken én rokken).",
          worn: true,
          enabled: true,
          removeRules: [{ notWorn: ["shoes"] }],
        },

        leggings: {
          name: "Legging",
          desc: "Voorbeelden: legging, panty, maillot. Omvat: aansluitende beenlaag die meestal onder broek/rok/jurk wordt gedragen.",
          worn: true,
          enabled: false,
          removeRules: [{ notWorn: ["shoes", "pants"] }],
        },

        underwear: {
          name: "Onderbroek",
          desc: "Voorbeelden: slip, boxer, string, bikini-onderstuk, onderste helft badpak. Omvat: alle onderkleding voor het onderlichaam.",
          worn: true,
          enabled: true,
          removeRules: [{ notWorn: ["pants", "leggings"] }],
        },

        shoes: {
          name: "Schoenen",
          desc: "Voorbeelden: sneakers, laarzen, hakken, sandalen, slippers, pantoffels. Omvat: alle schoeisel (alles samen één item).",
          worn: true,
          enabled: true,
          removeRules: [],
        },

        socks: {
          name: "Sokken",
          desc: "Voorbeelden: enkelsokken, kniekousen, kousen die onder schoenen vallen. Omvat: alle sokken/kousen die bij schoeisel worden gedragen.",
          worn: true,
          enabled: true,
          removeRules: [{ notWorn: ["shoes"] }],
        },
      };

      // ===== Standard player model =====
      const PLAYER_MODEL = {
        id: null,
        name: "",
        age: 18,
        sex: "unknown",
        prefer: "any",
        consent: false,
        score: 0,
        safe: false,
        clothing: null, // <- niet vooraf invullen met kopie
      };

      // ===== Helper: create a new player instance =====
      function createPlayer(name, sex = "unknown") {
        const player = JSON.parse(JSON.stringify(PLAYER_MODEL));
        player.id = crypto.randomUUID();
        player.name = name;
        player.sex = sex;
        player.clothing = deepCopy(CLOTHING_MODEL); // <- kopie hier
        return player;
      }

      // ===== Helper: check if clothing can be removed =====
      function canRemoveClothingPiece(key, clothingState) {
        const piece = clothingState[key];
        if (!piece) return false;
        const rules = piece.removeRules || [];
        // alle regels moeten voldoen
        return rules.every((rule) => {
          const notWorn = rule?.notWorn || [];
          return notWorn.every(
            (k) => clothingState[k] && clothingState[k].worn === false
          );
        });
      }
    </script>

    <!-- ==== Game: data + helpers ==== -->
    <script>
      function deepCopy(o) {
        return JSON.parse(JSON.stringify(o));
      }

      // Basis spelverloop-model (kan je later uitbreiden)
      const GAME_FLOW_MODEL = {
        version: 1,
        activePanel: "hoofdmenu",
        round: 1,
        turnIndex: 0,
        players: [], // je kunt hier straks createPlayer() instances in zetten
        settings: {}, // later: maxRolls, pointsToSafe, enz.
        tasks: {
          // ===== KLEDING =====
          undress_self: {
            name: "Uitkleden (Zelf - Basis)",
            desc: "Het uittrekken of verwijderen van een kledingstuk bij jezelf.",
            enabled: true,
            weight: 100,
            tasks: generateClothingTasks("Trek uit of verwijder"),
          },
          undress_other: {
            name: "Uitkleden (Ander - Basis)",
            desc: "Het uittrekken of verwijderen van een kledingstuk bij een ander.",
            enabled: true,
            weight: 100,
            tasks: generateClothingTasks("Trek uit of verwijder"),
          },
          dress_self: {
            name: "Aankleden (Zelf - Basis)",
            desc: "Het aantrekken of aanpassen van kleding bij jezelf.",
            enabled: true,
            weight: 100,
            tasks: generateClothingTasks("Trek aan of plaats"),
          },
          dress_other: {
            name: "Aankleden (Ander - Basis)",
            desc: "Het aantrekken of aanpassen van kleding bij een ander.",
            enabled: true,
            weight: 100,
            tasks: generateClothingTasks("Trek aan of plaats"),
          },

          // ===== EXPOSURE =====
          exposure_self_base: {
            name: "Onthulling (Zelf - Basis)",
            desc: "Het onthullen of zichtbaar maken van lichaamsdelen of kleding bij jezelf met basis-karakter (bijv. buik, rug, schouder).",
            enabled: true,
            weight: 100,
            tasks: [],
          },
          exposure_self_sensual: {
            name: "Onthulling (Zelf - Sensueel)",
            desc: "Het onthullen of zichtbaar maken van lichaamsdelen of kleding bij jezelf met sensueel uitdagende insteek (bijv. borst/borstlijn, dij, binnenbeen).",
            enabled: true,
            weight: 20,
            tasks: [],
          },
          exposure_self_sexual: {
            name: "Onthulling (Zelf - Seksueel)",
            desc: "Het onthullen of zichtbaar maken van lichaamsdelen of kleding bij jezelf met seksueel doel (bijv. geslachtsdelen).",
            enabled: true,
            weight: 0,
            tasks: [],
          },
          exposure_other_base: {
            name: "Onthulling (Ander - Basis)",
            desc: "Het onthullen of zichtbaar maken van lichaamsdelen of kleding bij een ander met basis-karakter (door jouw actie, niet op verzoek; bijv. buik, rug, schouder).",
            enabled: true,
            weight: 100,
            tasks: [],
          },
          exposure_other_sensual: {
            name: "Onthulling (Ander - Sensueel)",
            desc: "Het onthullen of zichtbaar maken van lichaamsdelen of kleding bij een ander met sensueel uitdagende insteek (door jouw actie; bijv. borst/borstlijn, dij, binnenbeen).",
            enabled: true,
            weight: 20,
            tasks: [],
          },
          exposure_other_sexual: {
            name: "Onthulling (Ander - Seksueel)",
            desc: "Het onthullen of zichtbaar maken van lichaamsdelen of kleding bij een ander met seksueel doel (door jouw actie; bijv. geslachtsdelen).",
            enabled: true,
            weight: 0,
            tasks: [],
          },

          // ===== POSES =====
          pose_self_innocent: {
            name: "Pose (Zelf - Onschuldig)",
            desc: "Het aannemen van een houding of pose bij jezelf met onschuldige insteek.",
            enabled: true,
            weight: 80,
            tasks: [],
          },
          pose_self_playful: {
            name: "Pose (Zelf - Speels)",
            desc: "Het aannemen van een houding of pose bij jezelf met speelse insteek.",
            enabled: true,
            weight: 60,
            tasks: [],
          },
          pose_self_romantic: {
            name: "Pose (Zelf - Romantisch)",
            desc: "Het aannemen van een houding of pose bij jezelf met romantische insteek.",
            enabled: true,
            weight: 40,
            tasks: [],
          },
          pose_self_sensual: {
            name: "Pose (Zelf - Sensueel)",
            desc: "Het aannemen van een houding of pose bij jezelf met sensueel uitdagende insteek.",
            enabled: true,
            weight: 20,
            tasks: [],
          },
          pose_self_sexual: {
            name: "Pose (Zelf - Seksueel)",
            desc: "Het aannemen van een houding of pose bij jezelf met seksueel doel.",
            enabled: true,
            weight: 0,
            tasks: [],
          },

          pose_other_innocent: {
            name: "Pose (Ander - Onschuldig)",
            desc: "Het aannemen van een houding of pose gericht op een ander met onschuldige insteek.",
            enabled: true,
            weight: 80,
            tasks: [],
          },
          pose_other_playful: {
            name: "Pose (Ander - Speels)",
            desc: "Het aannemen van een houding of pose gericht op een ander met speelse insteek.",
            enabled: true,
            weight: 60,
            tasks: [],
          },
          pose_other_romantic: {
            name: "Pose (Ander - Romantisch)",
            desc: "Het aannemen van een houding of pose gericht op een ander met romantische insteek.",
            enabled: true,
            weight: 40,
            tasks: [],
          },
          pose_other_sensual: {
            name: "Pose (Ander - Sensueel)",
            desc: "Het aannemen van een houding of pose gericht op een ander met sensueel uitdagende insteek.",
            enabled: true,
            weight: 20,
            tasks: [],
          },
          pose_other_sexual: {
            name: "Pose (Ander - Seksueel)",
            desc: "Het aannemen van een houding of pose gericht op een ander met seksueel doel.",
            enabled: true,
            weight: 0,
            tasks: [],
          },

          // ===== MOVEMENT =====
          movement_self_innocent: {
            name: "Beweging (Zelf - Onschuldig)",
            desc: "Het uitvoeren van een beweging door jezelf met onschuldige insteek.",
            enabled: true,
            weight: 80,
            tasks: [],
          },
          movement_self_playful: {
            name: "Beweging (Zelf - Speels)",
            desc: "Het uitvoeren van een beweging door jezelf met speelse insteek.",
            enabled: true,
            weight: 60,
            tasks: [],
          },
          movement_self_romantic: {
            name: "Beweging (Zelf - Romantisch)",
            desc: "Het uitvoeren van een beweging door jezelf met romantische insteek.",
            enabled: true,
            weight: 40,
            tasks: [],
          },
          movement_self_sensual: {
            name: "Beweging (Zelf - Sensueel)",
            desc: "Het uitvoeren van een beweging door jezelf met sensueel uitdagende insteek.",
            enabled: true,
            weight: 20,
            tasks: [],
          },
          movement_self_sexual: {
            name: "Beweging (Zelf - Seksueel)",
            desc: "Het uitvoeren van een beweging door jezelf met seksueel doel.",
            enabled: true,
            weight: 0,
            tasks: [],
          },

          // ===== TEASE =====
          tease_self_innocent: {
            name: "Teasen (Zelf - Onschuldig)",
            desc: "Het uitdagen of verleiden (teasen) door bij jezelf iets te doen met onschuldige insteek.",
            enabled: true,
            weight: 80,
            tasks: [],
          },
          tease_self_playful: {
            name: "Teasen (Zelf - Speels)",
            desc: "Het uitdagen of verleiden (teasen) door bij jezelf iets te doen met speelse insteek.",
            enabled: true,
            weight: 60,
            tasks: [],
          },
          tease_self_romantic: {
            name: "Teasen (Zelf - Romantisch)",
            desc: "Het uitdagen of verleiden (teasen) door bij jezelf iets te doen met romantische insteek.",
            enabled: true,
            weight: 40,
            tasks: [],
          },
          tease_self_sensual: {
            name: "Teasen (Zelf - Sensueel)",
            desc: "Het uitdagen of verleiden (teasen) door bij jezelf iets te doen met sensueel uitdagende insteek.",
            enabled: true,
            weight: 20,
            tasks: [],
          },
          tease_self_sexual: {
            name: "Teasen (Zelf - Seksueel)",
            desc: "Het uitdagen of verleiden (teasen) door bij jezelf iets te doen met seksueel doel.",
            enabled: true,
            weight: 0,
            tasks: [],
          },
          tease_self_sexual_oral: {
            name: "Teasen (Zelf - Seksueel - Oraal)",
            desc: "Het uitdagen of verleiden (teasen) door bij jezelf iets te doen met seksueel doel binnen het orale domein.",
            enabled: true,
            weight: 0,
            tasks: [],
          },
          tease_self_sexual_genital: {
            name: "Teasen (Zelf - Seksueel - Genitaal)",
            desc: "Het uitdagen of verleiden (teasen) door bij jezelf iets te doen met seksueel doel rond het genitale gebied (penis of vagina).",
            enabled: true,
            weight: 0,
            tasks: [],
          },
          tease_self_sexual_anal: {
            name: "Teasen (Zelf - Seksueel - Anaal)",
            desc: "Het uitdagen of verleiden (teasen) door bij jezelf iets te doen met seksueel doel rond het anale gebied.",
            enabled: true,
            weight: 0,
            tasks: [],
          },

          tease_other_innocent: {
            name: "Teasen (Ander - Onschuldig)",
            desc: "Het uitdagen of verleiden (teasen) door bij een ander iets te doen met onschuldige insteek.",
            enabled: true,
            weight: 80,
            tasks: [],
          },
          tease_other_playful: {
            name: "Teasen (Ander - Speels)",
            desc: "Het uitdagen of verleiden (teasen) door bij een ander iets te doen met speelse insteek.",
            enabled: true,
            weight: 60,
            tasks: [],
          },
          tease_other_romantic: {
            name: "Teasen (Ander - Romantisch)",
            desc: "Het uitdagen of verleiden (teasen) door bij een ander iets te doen met romantische insteek.",
            enabled: true,
            weight: 40,
            tasks: [],
          },
          tease_other_sensual: {
            name: "Teasen (Ander - Sensueel)",
            desc: "Het uitdagen of verleiden (teasen) door bij een ander iets te doen met sensueel uitdagende insteek.",
            enabled: true,
            weight: 20,
            tasks: [],
          },
          tease_other_sexual: {
            name: "Teasen (Ander - Seksueel)",
            desc: "Het uitdagen of verleiden (teasen) door bij een ander iets te doen met seksueel doel.",
            enabled: true,
            weight: 0,
            tasks: [],
          },
          tease_other_sexual_oral: {
            name: "Teasen (Ander - Seksueel - Oraal)",
            desc: "Het uitdagen of verleiden (teasen) door bij een ander iets te doen met seksueel doel binnen het orale domein.",
            enabled: true,
            weight: 0,
            tasks: [],
          },
          tease_other_sexual_genital: {
            name: "Teasen (Ander - Seksueel - Genitaal)",
            desc: "Het uitdagen of verleiden (teasen) door bij een ander iets te doen met seksueel doel rond het genitale gebied (penis of vagina).",
            enabled: true,
            weight: 0,
            tasks: [],
          },
          tease_other_sexual_anal: {
            name: "Teasen (Ander - Seksueel - Anaal)",
            desc: "Het uitdagen of verleiden (teasen) door bij een ander iets te doen met seksueel doel rond het anale gebied.",
            enabled: true,
            weight: 0,
            tasks: [],
          },

          // ===== TOUCH =====
          touch_self_innocent: {
            name: "Aanraking (Zelf - Onschuldig)",
            desc: "Het aanraken bij jezelf met onschuldige insteek.",
            enabled: true,
            weight: 80,
            tasks: [],
          },
          touch_self_playful: {
            name: "Aanraking (Zelf - Speels)",
            desc: "Het aanraken bij jezelf met speelse insteek.",
            enabled: true,
            weight: 60,
            tasks: [],
          },
          touch_self_romantic: {
            name: "Aanraking (Zelf - Romantisch)",
            desc: "Het aanraken bij jezelf met romantische insteek.",
            enabled: true,
            weight: 40,
            tasks: [],
          },
          touch_self_sensual: {
            name: "Aanraking (Zelf - Sensueel)",
            desc: "Het aanraken bij jezelf met sensueel uitdagende insteek.",
            enabled: true,
            weight: 20,
            tasks: [],
          },
          touch_self_sexual: {
            name: "Aanraking (Zelf - Seksueel)",
            desc: "Het aanraken bij jezelf met seksueel doel.",
            enabled: true,
            weight: 0,
            tasks: [],
          },
          touch_self_sexual_genital: {
            name: "Aanraking (Zelf - Seksueel - Genitaal)",
            desc: "Het aanraken bij jezelf met seksueel doel rond het genitale gebied (penis of vagina).",
            enabled: true,
            weight: 0,
            tasks: [],
          },
          touch_self_sexual_anal: {
            name: "Aanraking (Zelf - Seksueel - Anaal)",
            desc: "Het aanraken bij jezelf met seksueel doel rond het anale gebied.",
            enabled: true,
            weight: 0,
            tasks: [],
          },

          touch_other_innocent: {
            name: "Aanraking (Ander - Onschuldig)",
            desc: "Het aanraken bij een ander met onschuldige insteek.",
            enabled: true,
            weight: 80,
            tasks: [],
          },
          touch_other_playful: {
            name: "Aanraking (Ander - Speels)",
            desc: "Het aanraken bij een ander met speelse insteek.",
            enabled: true,
            weight: 60,
            tasks: [],
          },
          touch_other_romantic: {
            name: "Aanraking (Ander - Romantisch)",
            desc: "Het aanraken bij een ander met romantische insteek.",
            enabled: true,
            weight: 40,
            tasks: [],
          },
          touch_other_sensual: {
            name: "Aanraking (Ander - Sensueel)",
            desc: "Het aanraken bij een ander met sensueel uitdagende insteek.",
            enabled: true,
            weight: 20,
            tasks: [],
          },
          touch_other_sexual: {
            name: "Aanraking (Ander - Seksueel)",
            desc: "Het aanraken bij een ander met seksueel doel (niet specifiek genitaal of anaal).",
            enabled: true,
            weight: 0,
            tasks: [],
          },
          touch_other_sexual_genital: {
            name: "Aanraking (Ander - Seksueel - Genitaal)",
            desc: "Het aanraken bij een ander met seksueel doel rond het genitale gebied (penis of vagina).",
            enabled: true,
            weight: 0,
            tasks: [],
          },
          touch_other_sexual_anal: {
            name: "Aanraking (Ander - Seksueel - Anaal)",
            desc: "Het aanraken bij een ander met seksueel doel rond het anale gebied.",
            enabled: true,
            weight: 0,
            tasks: [],
          },

          // ===== INTERACTIE =====
          interaction_other_innocent: {
            name: "Interactie (Ander - Onschuldig)",
            desc: "Het uitvoeren van een handeling of interactie bij een ander met onschuldige insteek.",
            enabled: true,
            weight: 80,
            tasks: [],
          },
          interaction_other_playful: {
            name: "Interactie (Ander - Speels)",
            desc: "Het uitvoeren van een handeling of interactie bij een ander met speelse insteek.",
            enabled: true,
            weight: 60,
            tasks: [],
          },
          interaction_other_romantic: {
            name: "Interactie (Ander - Romantisch)",
            desc: "Het uitvoeren van een handeling of interactie bij een ander met romantische insteek.",
            enabled: true,
            weight: 40,
            tasks: [],
          },
          interaction_other_sensual: {
            name: "Interactie (Ander - Sensueel)",
            desc: "Het uitvoeren van een handeling of interactie bij een ander met sensueel uitdagende insteek.",
            enabled: true,
            weight: 20,
            tasks: [],
          },

          interaction_other_sexual: {
            name: "Interactie (Ander - Seksueel)",
            desc: "Het uitvoeren van een handeling of interactie bij een ander met seksueel doel (niet specifiek oraal, genitaal, anaal of handmatig).",
            enabled: true,
            weight: 0,
            tasks: [],
          },
          interaction_other_sexual_oral: {
            name: "Interactie (Ander - Seksueel - Oraal)",
            desc: "Het uitvoeren van een handeling of interactie bij een ander met seksueel doel binnen het orale domein.",
            enabled: true,
            weight: 0,
            tasks: [],
          },
          interaction_other_sexual_genital: {
            name: "Interactie (Ander - Seksueel - Genitaal)",
            desc: "Het uitvoeren van een handeling of interactie bij een ander met seksueel doel rond het genitale domein (penis of vagina).",
            enabled: true,
            weight: 0,
            tasks: [],
          },
          interaction_other_sexual_anal: {
            name: "Interactie (Ander - Seksueel - Anaal)",
            desc: "Het uitvoeren van een handeling of interactie bij een ander met seksueel doel binnen het anale domein.",
            enabled: true,
            weight: 0,
            tasks: [],
          },
          interaction_other_sexual_manual: {
            name: "Interactie (Ander - Seksueel - Handmatig)",
            desc: "Het uitvoeren van een handeling of interactie bij een ander met seksueel doel via handmatige stimulatie (handen of vingers).",
            enabled: true,
            weight: 0,
            tasks: [],
          },

          // ===== ROLEPLAY =====
          roleplay_other_innocent: {
            name: "Rollenspel (Onschuldig)",
            desc: "Het uitvoeren van een rollenspel gericht op een ander met onschuldige insteek; rollenspel kan elementen bevatten die niet worden beperkt door andere categorie-instellingen.",
            enabled: true,
            weight: 80,
            tasks: [],
          },
          roleplay_other_playful: {
            name: "Rollenspel (Speels)",
            desc: "Het uitvoeren van een rollenspel gericht op een ander met speelse insteek; rollenspel kan elementen bevatten die niet worden beperkt door andere categorie-instellingen.",
            enabled: true,
            weight: 60,
            tasks: [],
          },
          roleplay_other_romantic: {
            name: "Rollenspel (Romantisch)",
            desc: "Het uitvoeren van een rollenspel gericht op een ander met romantische insteek; rollenspel kan elementen bevatten die niet worden beperkt door andere categorie-instellingen.",
            enabled: true,
            weight: 40,
            tasks: [],
          },
          roleplay_other_sensual: {
            name: "Rollenspel (Sensueel)",
            desc: "Het uitvoeren van een rollenspel gericht op een ander met sensueel uitdagende insteek; rollenspel kan elementen bevatten die niet worden beperkt door andere categorie-instellingen.",
            enabled: true,
            weight: 20,
            tasks: [],
          },
          roleplay_other_sexual: {
            name: "Rollenspel (Seksueel)",
            desc: "Het uitvoeren van een rollenspel gericht op een ander met seksueel doel; rollenspel kan elementen uit alle domeinen omvatten, ongeacht andere categorie-instellingen.",
            enabled: true,
            weight: 0,
            tasks: [],
          },

          // ===== CHALLENGES =====
          challenge_self_innocent: {
            name: "Challenge (Zelf - Onschuldig)",
            desc: "Het uitvoeren van een uitdaging bij jezelf met onschuldige insteek; uitdagingen kunnen elementen bevatten die niet worden beperkt door andere categorie-instellingen.",
            enabled: true,
            weight: 80,
            tasks: [],
          },
          challenge_self_playful: {
            name: "Challenge (Zelf - Speels)",
            desc: "Het uitvoeren van een uitdaging bij jezelf met speelse insteek; uitdagingen kunnen elementen bevatten die niet worden beperkt door andere categorie-instellingen.",
            enabled: true,
            weight: 60,
            tasks: [],
          },
          challenge_self_romantic: {
            name: "Challenge (Zelf - Romantisch)",
            desc: "Het uitvoeren van een uitdaging bij jezelf met romantische insteek; uitdagingen kunnen elementen bevatten die niet worden beperkt door andere categorie-instellingen.",
            enabled: true,
            weight: 40,
            tasks: [],
          },
          challenge_self_sensual: {
            name: "Challenge (Zelf - Sensueel)",
            desc: "Het uitvoeren van een uitdaging bij jezelf met sensueel uitdagende insteek; uitdagingen kunnen elementen bevatten die niet worden beperkt door andere categorie-instellingen.",
            enabled: true,
            weight: 20,
            tasks: [],
          },
          challenge_self_sexual: {
            name: "Challenge (Zelf - Seksueel)",
            desc: "Het uitvoeren van een uitdaging bij jezelf met seksueel doel; uitdagingen kunnen elk domein omvatten, ongeacht andere categorie-instellingen.",
            enabled: true,
            weight: 0,
            tasks: [],
          },

          challenge_other_innocent: {
            name: "Challenge (Ander - Onschuldig)",
            desc: "Het uitvoeren van een uitdaging met of gericht op een ander met onschuldige insteek; uitdagingen kunnen elementen bevatten die niet worden beperkt door andere categorie-instellingen.",
            enabled: true,
            weight: 80,
            tasks: [],
          },
          challenge_other_playful: {
            name: "Challenge (Ander - Speels)",
            desc: "Het uitvoeren van een uitdaging met of gericht op een ander met speelse insteek; uitdagingen kunnen elementen bevatten die niet worden beperkt door andere categorie-instellingen.",
            enabled: true,
            weight: 60,
            tasks: [],
          },
          challenge_other_romantic: {
            name: "Challenge (Ander - Romantisch)",
            desc: "Het uitvoeren van een uitdaging met of gericht op een ander met romantische insteek; uitdagingen kunnen elementen bevatten die niet worden beperkt door andere categorie-instellingen.",
            enabled: true,
            weight: 40,
            tasks: [],
          },
          challenge_other_sensual: {
            name: "Challenge (Ander - Sensueel)",
            desc: "Het uitvoeren van een uitdaging met of gericht op een ander met sensueel uitdagende insteek; uitdagingen kunnen elementen bevatten die niet worden beperkt door andere categorie-instellingen.",
            enabled: true,
            weight: 20,
            tasks: [],
          },
          challenge_other_sexual: {
            name: "Challenge (Ander - Seksueel)",
            desc: "Het uitvoeren van een uitdaging met of gericht op een ander met seksueel doel; uitdagingen kunnen elk domein omvatten, ongeacht andere categorie-instellingen.",
            enabled: true,
            weight: 0,
            tasks: [],
          },
        },
      };

      // Huidige game state in memory
      window.GAME = deepCopy(GAME_FLOW_MODEL);

      function gameGetState() {
        return deepCopy(window.GAME);
      }

      function gameApplyState(state) {
        // start vanuit het model om ontbrekende velden te vullen
        window.GAME = deepCopy(GAME_FLOW_MODEL);
        Object.assign(window.GAME, state || {});
      }

      function gameSetActivePanel(key) {
        window.GAME.activePanel = key;
        storageSaveGame(gameGetState());
      }

      function gameInitFromStorage() {
        const saved = storageLoadGame();
        if (saved) {
          gameApplyState(saved);
          showPanel(window.GAME.activePanel || "hoofdmenu");
        } else {
          // eerste keer: toon hoofdmenu en sla meteen initiele state op
          showPanel("hoofdmenu");
          storageSaveGame(gameGetState());
        }
      }

      // Helper: dynamisch taken vullen op basis van CLOTHING_MODEL
      function generateClothingTasks(action) {
        const tasks = [];

        for (const [key, item] of Object.entries(CLOTHING_MODEL)) {
          tasks.push({
            name: `undress_${key}`,
            instruction: `${action} bij {target} ${item.name.toLowerCase()}.`,
            description: `Opdracht: ${action} bij {target} ${item.name.toLowerCase()} – ${
              item.desc
            }`,
          });
        }

        return tasks;
      }

      // Init bij laden
      document.addEventListener("DOMContentLoaded", gameInitFromStorage);
    </script>

    <!-- ==== Settings: helpers ==== -->
    <script>
      // Render toggles voor alle task-categorieën in window.GAME.tasks
      function renderTaskSettings(
        targetId = "settings_tasks",
        includeEmpty = false
      ) {
        const root = document.getElementById(targetId);
        if (!root) return;

        root.innerHTML = "";

        const tasks = window.GAME && window.GAME.tasks ? window.GAME.tasks : {};

        // Eerst alles nalopen en categorieën zonder taken uitschakelen
        for (const [key, cfg] of Object.entries(tasks)) {
          if (!Array.isArray(cfg?.tasks) || cfg.tasks.length === 0) {
            cfg.enabled = false;
          }
        }

        // Save disabled empty task categories
        storageSaveGame(window.GAME);

        // Dan alleen entries opnemen die aan de filter voldoen
        const entries = Object.entries(tasks)
          .filter(
            ([_, cfg]) =>
              includeEmpty ||
              (Array.isArray(cfg?.tasks) && cfg.tasks.length > 0)
          )
          .sort((a, b) => {
            const aName =
              a[1] && typeof a[1].name === "string" ? a[1].name : a[0];
            const bName =
              b[1] && typeof b[1].name === "string" ? b[1].name : b[0];
            return aName.localeCompare(bName);
          });

        entries.forEach(([key, cfg]) => {
          const name = cfg?.name ?? key;
          const desc = cfg?.desc ?? "";
          const enabled = !!cfg?.enabled;

          const row = document.createElement("div");
          row.style.borderBottom = "1px solid var(--border)";
          row.style.padding = "12px 0";
          row.style.display = "flex";
          row.style.gap = "12px";
          row.style.alignItems = "flex-start";

          const toggleWrap = document.createElement("div");
          const input = document.createElement("input");
          input.type = "checkbox";
          input.id = `task-${key}`;
          input.checked = enabled;
          input.style.width = "18px";
          input.style.height = "18px";
          input.style.cursor = "pointer";
          toggleWrap.appendChild(input);

          const textCol = document.createElement("div");
          textCol.style.display = "flex";
          textCol.style.flexDirection = "column";
          textCol.style.gap = "4px";

          const title = document.createElement("label");
          title.htmlFor = input.id;
          title.textContent = name;
          title.style.fontWeight = "600";
          title.style.cursor = "pointer";

          const description = document.createElement("div");
          description.className = "muted";
          description.textContent = desc;

          textCol.appendChild(title);
          textCol.appendChild(description);

          row.appendChild(toggleWrap);
          row.appendChild(textCol);
          root.appendChild(row);

          input.addEventListener("change", () => {
            if (window.GAME?.tasks?.[key]) {
              window.GAME.tasks[key].enabled = input.checked;
              if (typeof storageSaveGame === "function") {
                storageSaveGame(window.GAME);
              }
            }
          });
        });

        if (entries.length === 0) {
          const empty = document.createElement("div");
          empty.className = "muted";
          empty.style.padding = "8px 0";
          empty.textContent = "Geen categorieën gevonden.";
          root.appendChild(empty);
        }
      }

      // Voorbeeld: aanroepen nadat GAME geladen is of wanneer je het Instellingen-paneel opent
      renderTaskSettings();
    </script>
  </body>
</html>
